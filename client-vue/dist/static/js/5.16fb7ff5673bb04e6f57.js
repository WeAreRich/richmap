(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"+iPz":function(e,n,t){var r=t("Ce0W");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),t("SZ7m")("77ae7d2f",r,!0,{})},"2XyJ":function(e,n,t){"use strict";t.r(n);var r,o=t("Kw5r"),i=t("iFuS"),a=t("YKMj"),s=t("OK+q"),l=t("LdhC"),c=function(){function e(e){this.map=e,this.TAG="MapSourceAnimationService",this.ID="sourceId",this.counter=0,this.layers=[],this.sourceIds=[]}return e.prototype.addSource=function(e){var n=this;return new Promise(function(t){var r={type:"raster",url:e},o=n.ID+n.counter++;n.map.addSource(o,r),n.sourceIds.push(o),n.map.on("sourcedata",function(){t(o)})})},e.prototype.addSources=function(e){var n=this,t=e.map(function(e){return n.addSource(e)});return Promise.all(t)},e.prototype.showLayer=function(e){l.a.info(this.TAG,"id: "+e);var n=this.layers.findIndex(function(n){return n.id===e});if(n>-1)this.map.addLayer(this.layers[n]),l.a.info(this.TAG,"exist layer "+e);else{l.a.info(this.TAG,"not exist layer "+e);var t={id:e,type:"raster",source:e};this.map.addLayer(t),l.a.info(this.TAG,"add layer "+e),this.layers.push(t)}},e.prototype.hideLayer=function(e){this.layers.findIndex(function(n){return n.id===e})>-1&&this.map.removeLayer(e)},e.prototype.autoDisplay=function(){this.sourceIds.sort(),l.a.info(this.TAG,this.sourceIds),this.reAutoDisplay(0)},e.prototype.autoDisplayByRange=function(e,n){},e.prototype.reAutoDisplay=function(e){var n=this;e!==this.sourceIds.length&&(e>0&&this.hideLayer(this.sourceIds[e-1]),this.showLayer(this.sourceIds[e]),setTimeout(function(){n.reAutoDisplay(e+1)},1e3))},e.prototype.reAutoDisplayByRange=function(){},e}(),p=(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])},function(e,n){function t(){this.constructor=e}r(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),h=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.TAG="Try.vue",n.mapStyles=s.d,n.urls=["mapbox://wenxiangdong.0u7nbzi0","mapbox://wenxiangdong.dhr5yy3g"],n.ids=[],n.index="night-light-2013",n}return p(n,e),n.prototype.handleSelect=function(e){l.a.info(this.TAG,e)},n.prototype.handleOnMapLoad=function(e){l.a.info(this.TAG,"map loaded",e),this.map=e},n.prototype.handleChange=function(){var e=this;l.a.info(this.TAG,"change"),this.animationService=new c(this.map);var n=this.animationService;this.urls.map(function(e){return n.addSource(e)}),this.animationService.addSources(this.urls).then(function(n){l.a.info(e.TAG,n),e.ids=[],e.ids=n})},n.prototype.handleShow=function(e){l.a.info(this.TAG,e),this.animationService.showLayer(e)},n.prototype.handleHide=function(){this.animationService&&this.animationService.hideLayer(this.id)},n.prototype.handleAuto=function(){this.animationService.autoDisplay()},function(e,n,t,r){var o,i=arguments.length,a=i<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,n,t,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(n,t,a):o(n,t))||a);return i>3&&a&&Object.defineProperty(n,t,a),a}([Object(a.a)({components:{PovertyMap:i.a}})],n)}(o.default),u=(t("ymnH"),t("KHd+")),d=Object(u.a)(h,function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticStyle:{width:"80%",margin:"auto"}},[t("poverty-map",{on:{"on-map-load":e.handleOnMapLoad}}),e._v(" "),t("Button",{on:{click:e.handleChange}},[e._v("change")]),e._v(" "),t("Button",{on:{click:e.handleHide}},[e._v("hide")]),e._v(" "),t("ol",e._l(e.ids,function(n){return t("li",[e._v("\n            "+e._s(n)+"\n            "),t("Button",{on:{click:function(t){e.handleShow(n)}}},[e._v("显示")])],1)})),e._v(" "),t("Button",{on:{click:e.handleAuto}},[e._v("Auto")])],1)},[],!1,null,null,null);n.default=d.exports},"3IHN":function(e,n,t){var r=t("559u");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals),t("SZ7m")("5125f571",r,!0,{})},"559u":function(e,n,t){(e.exports=t("I1BE")(!0)).push([e.i,"","",{version:3,sources:[],names:[],mappings:"",file:"Try.vue?vue&type=style&index=0&lang=css",sourceRoot:""}])},Ce0W:function(e,n,t){(e.exports=t("I1BE")(!0)).push([e.i,".outer[data-v-24453468]{position:relative;background:inherit;width:100%;box-shadow:0 0 10px rgba(0,0,0,.5)}#map-container[data-v-24453468]{height:600px;width:100%}.border-control[data-v-24453468]{display:inline-block;position:absolute;z-index:999}","",{version:3,sources:["D:/richmap/client-vue/src/components/common/map/poverty-map/src/components/common/map/poverty-map/PovertyMap.vue"],names:[],mappings:"AAqLA,wBACA,kBAAA,AAEA,mBAAA,AACA,WAAA,AACA,kCAAA,CACA,AAEA,gCACA,aAAA,AACA,UAAA,CACA,AAEA,iCACA,qBAAA,AACA,kBAAA,AACA,WAAA,CACA",file:"PovertyMap.vue?vue&type=style&index=0&id=24453468&scoped=true&lang=css",sourcesContent:['<template>\r\n    <div class="outer">\r\n        <div class="border-control">\r\n            <Dropdown trigger="click" style="position: relative" placement="bottom-start">\r\n                <Tooltip content="边界" placement="right">\r\n                    <Button icon="ios-browsers"></Button>\r\n                </Tooltip>\r\n                <DropdownMenu slot="list" style="text-align: left; width: 130px;">\r\n                    <div style="display: flex; flex-direction: column; padding: 10px;">\r\n                        <Checkbox label="一级行政区边界" @on-change="handleChangeFirstLevelCheckBox">一级行政区边界</Checkbox>\r\n                        <Checkbox label="二级行政区边界" @on-change="handleChangeSecondLevelCheckBox">二级行政区边界</Checkbox>\r\n                        <Checkbox label="三级行政区边界" @on-change="handleChangeThirdLevelCheckBox">三级行政区边界</Checkbox>\r\n                    </div>\r\n                </DropdownMenu>\r\n            </Dropdown>\r\n        </div>\r\n        <div id="map-container"></div>\r\n    </div>\r\n</template>\r\n\r\n<script lang="ts">\r\n  import Vue from \'vue\';\r\n  import { Component, Emit, Prop, Watch } from \'vue-property-decorator\';\r\n  import NominatimService from \'../../../../services/nominatim.service\';\r\n  import { Logger } from \'../../../../services/Logger\';\r\n  import mapboxgl from \'mapbox-gl\';\r\n  import { ACCESS_TOKEN, CHINA_BOUNDS, CHINA_CENTER } from \'../../../../constants/mapbox\';\r\n  import PlaceItem from \'../../../../types/place-item\';\r\n\r\n  @Component\r\n  export default class PovertyMap extends Vue {\r\n    private TAG = \'PovertyMap\';\r\n    private FIRST_LEVEL_LAYER_ID = \'first-level\';\r\n    private SECOND_LEVEL_LAYER_ID = \'second-level\';\r\n    private THIRD_LEVEL_LAYER_ID = \'third-level\';\r\n    private borderPaint = {\r\n      \'line-color\': \'rgba(255,255,255,0.5)\',\r\n      \'line-width\': 2\r\n    };\r\n\r\n    // 行政区域划分图层\r\n    private firstLevelLayer: mapboxgl.Layer;\r\n    private secondLevelLayer: mapboxgl.Layer;\r\n    private thirdLevelLayer: mapboxgl.Layer;\r\n    private map: mapboxgl.Map;\r\n\r\n\r\n    // 基础地图源\r\n    @Prop({\r\n      default: () => \'mapbox://styles/mapbox/satellite-v9\'\r\n    })\r\n    public mapUrl: string;\r\n\r\n\r\n    @Watch(\'mapUrl\')\r\n    onMapUrlChange(val: string, oldVal: string) {\r\n      Logger.info(this.TAG, val, oldVal);\r\n      this.map.setStyle(val);\r\n    }\r\n\r\n    // data\r\n    public query: string;\r\n    public searchItems: PlaceItem[];\r\n\r\n    // services\r\n    private nominatimService: NominatimService;\r\n\r\n    constructor() {\r\n      super();\r\n      Logger.info(this.TAG, "constructor");\r\n      this.query = "";\r\n      this.searchItems = [];\r\n      this.nominatimService = new NominatimService();\r\n    }\r\n\r\n    mounted() {\r\n      Logger.info(this.TAG, "mounted");\r\n      this.initMap();\r\n    }\r\n\r\n    private initMap() {\r\n      Logger.info(this.TAG, "start init map");\r\n      mapboxgl.accessToken = ACCESS_TOKEN;\r\n      this.map = new mapboxgl.Map({\r\n        container: \'map-container\',\r\n        style: this.mapUrl,\r\n        center: CHINA_CENTER,\r\n        maxBounds: CHINA_BOUNDS\r\n      });\r\n      // 增加控件\r\n      this.map.addControl(new mapboxgl.NavigationControl());\r\n      this.map.addControl(new mapboxgl.ScaleControl());\r\n      // 初始化完成\r\n      this.map.on("load", () => {\r\n        this.onMapLoad(this.map);\r\n        // console.log(this.map.getZoom());\r\n      });\r\n    }\r\n\r\n    /* 事件emit */\r\n    // 地图加载完成，返回一个 mapboxgl 地图对象\r\n    @Emit()\r\n    public onMapLoad(map: mapboxgl.Map) {}\r\n\r\n    /* 下面是事件处理 */\r\n\r\n    public handleChangeFirstLevelCheckBox(value) {\r\n      if (value) {\r\n        this.showFirstLevelBorder();\r\n      } else {\r\n        this.map.removeLayer(this.FIRST_LEVEL_LAYER_ID);\r\n      }\r\n    }\r\n\r\n    public handleChangeSecondLevelCheckBox(value) {\r\n      if (value) {\r\n        this.showSecondLevelBorder();\r\n      } else {\r\n        this.map.removeLayer(this.SECOND_LEVEL_LAYER_ID);\r\n      }\r\n    }\r\n\r\n    public handleChangeThirdLevelCheckBox(value) {\r\n      if (value) {\r\n        this.showThirdLevelBorder();\r\n      } else {\r\n        this.map.removeLayer(this.THIRD_LEVEL_LAYER_ID);\r\n        this.map.removeSource(this.FIRST_LEVEL_LAYER_ID);\r\n      }\r\n    }\r\n\r\n    public showFirstLevelBorder() {\r\n      Logger.info(this.TAG, "show first level border");\r\n      // 未加载过\r\n      if (!this.firstLevelLayer) {\r\n        this.map.addSource(this.FIRST_LEVEL_LAYER_ID, {\r\n          type: \'vector\',\r\n          url: \'mapbox://wenxiangdong.d4tbuoxg\'\r\n        });\r\n        let layer: mapboxgl.Layer = {\r\n          id: this.FIRST_LEVEL_LAYER_ID,\r\n          type: "line",\r\n          source: this.FIRST_LEVEL_LAYER_ID,\r\n          \'source-layer\': \'china-9o3cd8\',\r\n          paint: this.borderPaint\r\n        };\r\n        this.firstLevelLayer = layer;\r\n      }\r\n      this.map.addLayer(this.firstLevelLayer);\r\n      this.map.on(\'sourcedata\', this.FIRST_LEVEL_LAYER_ID, () => {\r\n        Logger.info(this.TAG, \'load layer\');\r\n      })\r\n    }\r\n\r\n    public showSecondLevelBorder() {\r\n      Logger.info(this.TAG, "showSecondLevelBorder");\r\n      // 未加载过\r\n      if (!this.secondLevelLayer) {\r\n        this.map.addSource(this.SECOND_LEVEL_LAYER_ID, {\r\n          type: \'vector\',\r\n          url: \'mapbox://wenxiangdong.5wsa80lc\'\r\n        });\r\n        let layer: mapboxgl.Layer = {\r\n          id: this.SECOND_LEVEL_LAYER_ID,\r\n          type: "line",\r\n          source: this.SECOND_LEVEL_LAYER_ID,\r\n          paint: this.borderPaint,\r\n          \'source-layer\': \'true\'\r\n        };\r\n        this.secondLevelLayer = layer;\r\n      }\r\n      this.map.addLayer(this.secondLevelLayer);\r\n    }\r\n\r\n    public showThirdLevelBorder() {\r\n      Logger.info(this.TAG, "showThirdLevelBorder");\r\n    }\r\n  }\r\n<\/script>\r\n\r\n<style scoped>\r\n    .outer {\r\n        position: relative;\r\n        /*background-image: linear-gradient( 135deg, #92FFC0 30%, #00266150 100%);*/\r\n        background: inherit;\r\n        width: 100%;\r\n        box-shadow: rgba(0, 0, 0, 0.5) 0 0 10px;\r\n    }\r\n\r\n    #map-container {\r\n        height: 600px;\r\n        width: 100%;\r\n    }\r\n\r\n    .border-control {\r\n        display: inline-block;\r\n        position: absolute;\r\n        z-index: 999;\r\n    }\r\n</style>'],sourceRoot:""}])},LdhC:function(e,n,t){"use strict";t.d(n,"a",function(){return r});var r=function(){function e(){}return e.info=function(n){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if((new Date).toLocaleTimeString(),console.info)for(var o=0,i=t;o<i.length;o++)i[o];else e.log.apply(e,[n].concat(t))},e.error=function(n){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if((new Date).toLocaleTimeString(),console.error)for(var o=0,i=t;o<i.length;o++)i[o];else e.log.apply(e,[n].concat(t))},e.log=function(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];(new Date).toLocaleTimeString();for(var r=0,o=n;r<o.length;r++)o[r]},e}()},"OK+q":function(e,n,t){"use strict";t.d(n,"a",function(){return r}),t.d(n,"b",function(){return o}),t.d(n,"c",function(){return i}),t.d(n,"d",function(){return a});var r="pk.eyJ1Ijoid2VueGlhbmdkb25nIiwiYSI6ImNqajEyN2owYjBvNHYzdm10c2p2NXowM2kifQ.kixIr8Jwk2mAqmlQCWW88Q",o=[[70,17],[140,55]],i=[104.999927,35.000074],a={"night-light-2001":"mapbox://styles/wenxiangdong/cjjuyolqw21sf2rmmrrp13azv","night-light-2013":"mapbox://styles/wenxiangdong/cjjuzjzid0a1a2ro45v4abumf"}},iFuS:function(e,n,t){"use strict";var r,o=t("Kw5r"),i=t("YKMj"),a=t("jF86"),s=t("LdhC"),l=t("4ZJM"),c=t.n(l),p=t("OK+q"),h=(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])},function(e,n){function t(){this.constructor=e}r(e,n),e.prototype=null===n?Object.create(n):(t.prototype=n.prototype,new t)}),u=function(e,n,t,r){var o,i=arguments.length,a=i<3?n:null===r?r=Object.getOwnPropertyDescriptor(n,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,n,t,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(n,t,a):o(n,t))||a);return i>3&&a&&Object.defineProperty(n,t,a),a},d=function(e){function n(){var n=e.call(this)||this;return n.TAG="PovertyMap",n.FIRST_LEVEL_LAYER_ID="first-level",n.SECOND_LEVEL_LAYER_ID="second-level",n.THIRD_LEVEL_LAYER_ID="third-level",n.borderPaint={"line-color":"rgba(255,255,255,0.5)","line-width":2},s.a.info(n.TAG,"constructor"),n.query="",n.searchItems=[],n.nominatimService=new a.a,n}return h(n,e),n.prototype.onMapUrlChange=function(e,n){s.a.info(this.TAG,e,n),this.map.setStyle(e)},n.prototype.mounted=function(){s.a.info(this.TAG,"mounted"),this.initMap()},n.prototype.initMap=function(){var e=this;s.a.info(this.TAG,"start init map"),c.a.accessToken=p.a,this.map=new c.a.Map({container:"map-container",style:this.mapUrl,center:p.c,maxBounds:p.b}),this.map.addControl(new c.a.NavigationControl),this.map.addControl(new c.a.ScaleControl),this.map.on("load",function(){e.onMapLoad(e.map)})},n.prototype.onMapLoad=function(e){},n.prototype.handleChangeFirstLevelCheckBox=function(e){e?this.showFirstLevelBorder():this.map.removeLayer(this.FIRST_LEVEL_LAYER_ID)},n.prototype.handleChangeSecondLevelCheckBox=function(e){e?this.showSecondLevelBorder():this.map.removeLayer(this.SECOND_LEVEL_LAYER_ID)},n.prototype.handleChangeThirdLevelCheckBox=function(e){e?this.showThirdLevelBorder():(this.map.removeLayer(this.THIRD_LEVEL_LAYER_ID),this.map.removeSource(this.FIRST_LEVEL_LAYER_ID))},n.prototype.showFirstLevelBorder=function(){var e=this;if(s.a.info(this.TAG,"show first level border"),!this.firstLevelLayer){this.map.addSource(this.FIRST_LEVEL_LAYER_ID,{type:"vector",url:"mapbox://wenxiangdong.d4tbuoxg"});var n={id:this.FIRST_LEVEL_LAYER_ID,type:"line",source:this.FIRST_LEVEL_LAYER_ID,"source-layer":"china-9o3cd8",paint:this.borderPaint};this.firstLevelLayer=n}this.map.addLayer(this.firstLevelLayer),this.map.on("sourcedata",this.FIRST_LEVEL_LAYER_ID,function(){s.a.info(e.TAG,"load layer")})},n.prototype.showSecondLevelBorder=function(){if(s.a.info(this.TAG,"showSecondLevelBorder"),!this.secondLevelLayer){this.map.addSource(this.SECOND_LEVEL_LAYER_ID,{type:"vector",url:"mapbox://wenxiangdong.5wsa80lc"});var e={id:this.SECOND_LEVEL_LAYER_ID,type:"line",source:this.SECOND_LEVEL_LAYER_ID,paint:this.borderPaint,"source-layer":"true"};this.secondLevelLayer=e}this.map.addLayer(this.secondLevelLayer)},n.prototype.showThirdLevelBorder=function(){s.a.info(this.TAG,"showThirdLevelBorder")},u([Object(i.c)({default:function(){return"mapbox://styles/mapbox/satellite-v9"}})],n.prototype,"mapUrl",void 0),u([Object(i.e)("mapUrl")],n.prototype,"onMapUrlChange",null),u([Object(i.b)()],n.prototype,"onMapLoad",null),u([i.a],n)}(o.default),f=(t("jqtz"),t("KHd+")),v=Object(f.a)(d,function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"outer"},[t("div",{staticClass:"border-control"},[t("Dropdown",{staticStyle:{position:"relative"},attrs:{trigger:"click",placement:"bottom-start"}},[t("Tooltip",{attrs:{content:"边界",placement:"right"}},[t("Button",{attrs:{icon:"ios-browsers"}})],1),e._v(" "),t("DropdownMenu",{staticStyle:{"text-align":"left",width:"130px"},attrs:{slot:"list"},slot:"list"},[t("div",{staticStyle:{display:"flex","flex-direction":"column",padding:"10px"}},[t("Checkbox",{attrs:{label:"一级行政区边界"},on:{"on-change":e.handleChangeFirstLevelCheckBox}},[e._v("一级行政区边界")]),e._v(" "),t("Checkbox",{attrs:{label:"二级行政区边界"},on:{"on-change":e.handleChangeSecondLevelCheckBox}},[e._v("二级行政区边界")]),e._v(" "),t("Checkbox",{attrs:{label:"三级行政区边界"},on:{"on-change":e.handleChangeThirdLevelCheckBox}},[e._v("三级行政区边界")])],1)])],1)],1),e._v(" "),t("div",{attrs:{id:"map-container"}})])},[],!1,null,"24453468",null);n.a=v.exports},jF86:function(e,n,t){"use strict";var r=t("LdhC"),o=function(){function e(){}return e.prototype.search=function(e){return function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(a,s)}l((r=r.apply(e,n||[])).next())})}(this,void 0,void 0,function(){var n,t,o;return function(e,n){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=n.call(e,a)}catch(e){i=[6,e],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(i){switch(i.label){case 0:n="http://nominatim.openstreetmap.org/search?format=json&q="+decodeURIComponent(e),r.a.info(this,"start to fetch "+n),i.label=1;case 1:return i.trys.push([1,4,,5]),[4,fetch(n)];case 2:return[4,(t=i.sent()).json()];case 3:return t=i.sent(),r.a.info(this,"fetch success",t),[2,t];case 4:throw o=i.sent(),r.a.error(this,"fetch error",o),o;case 5:return[2]}})})},e}();n.a=o},jqtz:function(e,n,t){"use strict";var r=t("+iPz");t.n(r).a},ymnH:function(e,n,t){"use strict";var r=t("3IHN");t.n(r).a}}]);
//# sourceMappingURL=5.16fb7ff5673bb04e6f57.js.map